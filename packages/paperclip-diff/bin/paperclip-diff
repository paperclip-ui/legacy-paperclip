#!/usr/bin/env node

const { start, detectChanges, snapshot } = require("../lib");

const yargs = require("yargs");

yargs.command("snapshot", "Take snapshots of the current PR", yargs => {
  yargs
  .option("force", { description: "Force snapshot creation even if there are changes" });
}, async argv => {
  const provider = await start(process.cwd());
  await snapshot(provider)(argv.force);
  provider.close();
})
.command("detect-changes [branch]", "Show changes against a different branch", yargs => {
  yargs
  .option("watch", { description: "re-run when a PC file changes" });
}, async argv => {
  const provider = await start(process.cwd());
  await detectChanges(provider)(argv.branch, argv.watch);
  if (!argv.watch) {
    provider.close();
  }
}).argv;